/* claudio.dcv@gmail.com */
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.readAndLogFileContent=exports.saveEnvConfiguration=exports.getEnvConfiguration=void 0;const t=e(require("fs")),n=require("../db/models"),i=async()=>{const e=await n.EnvConfiguration.findOne();return e?e.toJSON():null};exports.getEnvConfiguration=i;const o=async(e,t)=>{const i=await n.EnvConfiguration.findOne();i&&await i.destroy();const o=new n.EnvConfiguration({fileName:e,variables:t});await o.save(),(0,exports.readAndLogFileContent)(e,t)};exports.saveEnvConfiguration=o;const E=(e,n)=>{try{let i="";if(t.default.existsSync(e)?i=t.default.readFileSync(e,"utf-8"):(i="# START::ENVS:DEPLOYMANAGER\n# END::ENVS:DEPLOYMANAGER",t.default.writeFileSync(e,i,"utf-8")),i.includes("# START::ENVS:DEPLOYMANAGER")||i.includes("# END::ENVS:DEPLOYMANAGER")||(i=`${i}\n# START::ENVS:DEPLOYMANAGER\n# END::ENVS:DEPLOYMANAGER`,t.default.writeFileSync(e,i,"utf-8")),n){const o=n.map((e=>`export ${e.key}="${e.value.replace(/"/g,'\\"')}"`)).join("\n"),E=i.replace(/# START::ENVS:DEPLOYMANAGER[\s\S]*?# END::ENVS:DEPLOYMANAGER/,`# START::ENVS:DEPLOYMANAGER\n${o}\n# END::ENVS:DEPLOYMANAGER`);t.default.writeFileSync(e,E,"utf-8")}}catch(e){}};exports.readAndLogFileContent=E;