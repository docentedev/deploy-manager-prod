/* claudio.dcv@gmail.com */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("../services/deployService"),t=require("../db/models");async function s(s,o,r,i){const{key:c,name:n,baseDir:u,script:d}=i,p=s.user,a=d.trim().split("\n").map((e=>e.trim())),l=[];for(const s of a)if(s)try{null==r||r.emit("deploy-api",{type:"stdout",message:`Executing command: ${s}`}),await(0,e.executeCommand)(`cd ${u} && ${s}`,r,"deploy-api",l)}catch(e){l.push(e instanceof Error?e.toString():String(e));const s=e instanceof Error?e.toString():String(e);return t.DeployLog.create({userId:p.id,deployConfigId:i.id,output:l.reduce(((e,t)=>e+t+"\n"),""),status:"failure"}),void o.status(500).json({success:!1,error:s})}t.DeployLog.create({userId:p.id,deployConfigId:i.id,output:l.reduce(((e,t)=>e+t+"\n"),""),status:"success"}),o.json({success:!0,message:"API deploy completed"})}module.exports={deployApi:s};